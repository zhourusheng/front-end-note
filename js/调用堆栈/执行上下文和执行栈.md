# 理解JavaScript 中的执行上下文和执行栈

执行上下文和执行栈是 JavaScript 中关键概念之一
理解执行上下文和执行栈有助于理解其他概念，如：提升机制、作用域和闭包等

## 一、执行上下文（Execution Context）

### 1.什么是执行上下文

执行上下文就是当前 JavaScript 代码被解析和执行时所在环境的抽象概念，
JavaScript 中执行任何代码都是在执行上下文中运行

### 2. 执行上下文的类型

执行上下文共三种类型：

* 全局执行上下文：全局执行上下文是最默认的，最基础的执行上下文。不在任何函数中的代码都位于全局执行上下文中。
  它做了两件事：1.创建一个全局对象，在浏览器中这个全局对象就是 window 对象。 2.将 this 指针指向这个全局对象。
  一个程序中智能存在一个全局执行上下文。

* 函数执行上下文： 每次调用函数时，都会为该函数创建一个新的执行上下文。
  每个函数都拥有自己的执行上下文，但是只有在函数被调用的时候才会被创建。
  一个程序中可以存在任意数量的函数执行上下文。每当一个新的执行上下文被创建，它都会按照特定的顺序执行一系列步骤，

* Eval函数执行上下文：运行在 eval 函数中的代码也获得了自己的执行上下文，但由于 Javascript 开发人员不常用 eval 函数，所以在这里不再讨论。

## 二、执行上下文的生命周期

执行上下文的生命周期包括三个阶段：**创建阶段 > 执行阶段 > 回收阶段**

### 1.创建阶段

当函数被调用，但未执行任何其内部代码之前，会做以下三件事：

* 创建变量对象：首先初始化函数的参数 arguments ，提升函数声明和变量声明。
* 创建作用域链（Scope Chain）：在执行上下文的创建阶段，作用域链是在变量对象之后创建的。
    作用域链本身包含变量对象。作用域链用于解析变量。当被要求解析变量时，JavaScript 始终从代码嵌套最内层开始
    如果最内层没有找到变量，就会跳到上一层父级作用域中查找，直到找到该变量。
* 确定this指向：包含this多中情况

在一段 JS 脚本执行之前，要先解析代码（所以说 JS 是解释执行的脚本语言），解析前会先创建一个全局执行上下文
，先把代码中即将执行的变量、函数声明都拿出来。变量暂时赋值为 undefiend，函数则先声明好可使用。

### 2.执行阶段

执行变量赋值、代码执行

### 3.回收阶段

执行上下文出栈等待虚拟机回收执行上下文


## 三、变量提升和this指向的细节

### 1.变量声明提升

### 2.函数声明提升

### 3.确定this的指向


## 四、执行上下文栈（Execution Context Stack）
 
























## 参考：
[深入理解JavaScript执行上下文和执行栈](https://github.com/ljianshu/Blog/issues/60)
[理解JavaScript 中的执行上下文和执行栈](https://github.com/yygmind/blog/issues/12)